<!DOCTYPE html>
<html lang="en"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Hugo博客一建自动部署以及本地备份</title>
    <meta charset="utf-8">
    <meta name="description" content="Ladder@find ./bilibytes.github.io -mindepth 1 ! -name &#34;.git&#34; ! -name &#34;CNAME&#34; ! -path &#34;./bilibytes.github.io .git/*&#34; -exec rm -rf {} &#43; python3 backup_website_in_html.py hugo cd bilibytes.github.io git init git remote add origin https://github.com/bilibytes/bilibytes.github.io.git git add . git commit -m &#34;$(date)&#34; git pull --rebase origin main git push --set-upstream origin main import os import re import markdown import requests from pathlib import Path import shutil import yaml from urllib.parse import urlparse def extract_metadata_and_content(markdown_content):">
    <meta name="author" content="BiliBytes">
    <link rel="canonical" href="https://www.dayday.plus/tech/2024-08-30-hugo%E5%8D%9A%E5%AE%A2%E4%B8%80%E9%94%AE%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E4%BB%A5%E5%8F%8A%E6%9C%AC%E5%9C%B0%E5%A4%87%E4%BB%BD/">

    <link rel="alternate" type="application/rss+xml" href="https://www.dayday.plus//index.xml" title="bilibytes.com">

    
  




    <meta property="og:url" content="https://www.dayday.plus/tech/2024-08-30-hugo%E5%8D%9A%E5%AE%A2%E4%B8%80%E9%94%AE%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E4%BB%A5%E5%8F%8A%E6%9C%AC%E5%9C%B0%E5%A4%87%E4%BB%BD/">
  <meta property="og:site_name" content="bilibytes.com">
  <meta property="og:title" content=" Hugo博客一建自动部署以及本地备份">
  <meta property="og:description" content="find ./bilibytes.github.io -mindepth 1 ! -name &#34;.git&#34; ! -name &#34;CNAME&#34; ! -path &#34;./bilibytes.github.io .git/*&#34; -exec rm -rf {} &#43; python3 backup_website_in_html.py hugo cd bilibytes.github.io git init git remote add origin https://github.com/bilibytes/bilibytes.github.io.git git add . git commit -m &#34;$(date)&#34; git pull --rebase origin main git push --set-upstream origin main import os import re import markdown import requests from pathlib import Path import shutil import yaml from urllib.parse import urlparse def extract_metadata_and_content(markdown_content):">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="tech">
    <meta property="article:published_time" content="2024-08-30T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-08-30T20:37:54+02:00">
    <meta property="article:tag" content="网站">


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content=" Hugo博客一建自动部署以及本地备份">
  <meta name="twitter:description" content="find ./bilibytes.github.io -mindepth 1 ! -name &#34;.git&#34; ! -name &#34;CNAME&#34; ! -path &#34;./bilibytes.github.io .git/*&#34; -exec rm -rf {} &#43; python3 backup_website_in_html.py hugo cd bilibytes.github.io git init git remote add origin https://github.com/bilibytes/bilibytes.github.io.git git add . git commit -m &#34;$(date)&#34; git pull --rebase origin main git push --set-upstream origin main import os import re import markdown import requests from pathlib import Path import shutil import yaml from urllib.parse import urlparse def extract_metadata_and_content(markdown_content):">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Teches",
      "item": "https://www.dayday.plus/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": " Hugo博客一建自动部署以及本地备份",
      "item": "https://www.dayday.plus/tech/2024-08-30-hugo%E5%8D%9A%E5%AE%A2%E4%B8%80%E9%94%AE%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E4%BB%A5%E5%8F%8A%E6%9C%AC%E5%9C%B0%E5%A4%87%E4%BB%BD/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": " Hugo博客一建自动部署以及本地备份",
  "name": " Hugo博客一建自动部署以及本地备份",
  "description": "find ./bilibytes.github.io -mindepth 1 ! -name \u0026#34;.git\u0026#34; ! -name \u0026#34;CNAME\u0026#34; ! -path \u0026#34;./bilibytes.github.io .git/*\u0026#34; -exec rm -rf {} + python3 backup_website_in_html.py hugo cd bilibytes.github.io git init git remote add origin https://github.com/bilibytes/bilibytes.github.io.git git add . git commit -m \u0026#34;$(date)\u0026#34; git pull --rebase origin main git push --set-upstream origin main import os import re import markdown import requests from pathlib import Path import shutil import yaml from urllib.parse import urlparse def extract_metadata_and_content(markdown_content):",
  "keywords": [
    "网站"
  ],
  "articleBody": "find ./bilibytes.github.io -mindepth 1 ! -name \".git\" ! -name \"CNAME\" ! -path \"./bilibytes.github.io .git/*\" -exec rm -rf {} + python3 backup_website_in_html.py hugo cd bilibytes.github.io git init git remote add origin https://github.com/bilibytes/bilibytes.github.io.git git add . git commit -m \"$(date)\" git pull --rebase origin main git push --set-upstream origin main import os import re import markdown import requests from pathlib import Path import shutil import yaml from urllib.parse import urlparse def extract_metadata_and_content(markdown_content): metadata = {} match = re.match(r'^---\\n([\\s\\S]+?)\\n---\\n([\\s\\S]*)', markdown_content) if match: metadata = yaml.safe_load(match.group(1)) content = match.group(2) return metadata, content return {}, markdown_content def extract_content_after_title(markdown_content): match = re.search(r'(?:^|\\n)#+\\s+(.+?)(?:\\n|$)([\\s\\S]*)', markdown_content) if match: return match.group(2) return markdown_content def download_image(image_url, images_folder, retries=3): parsed_url = urlparse(image_url) image_name = os.path.basename(parsed_url.path) local_image_path = os.path.join(images_folder, image_name) if parsed_url.scheme in ('http', 'https'): for attempt in range(retries): try: response = requests.get(image_url, stream=True, timeout=5) if response.status_code == 200: with open(local_image_path, 'wb') as out_file: shutil.copyfileobj(response.raw, out_file) break except requests.exceptions.RequestException as e: print(f\"Attempt {attempt + 1} failed to download {image_url}: {e}\") if attempt == retries - 1: print(f\"Failed to download image after {retries} attempts: {image_url}\") return None else: if os.path.exists(image_url): shutil.copy(image_url, local_image_path) else: print(f\"Local image not found: {image_url}\") return None return os.path.join('html_images_local', image_name) def update_image_paths(html_content, input_folder, images_folder): img_tags = re.findall(r']+src=\"([^\"\u003e]+)\"', html_content) for img_path in img_tags: if not urlparse(img_path).scheme: img_path = os.path.join(input_folder, img_path) local_img_path = download_image(img_path, images_folder) if local_img_path: html_content = html_content.replace(img_path, local_img_path) return html_content def markdown_to_html(markdown_content, input_folder, output_folder): metadata, content = extract_metadata_and_content(markdown_content) content_to_convert = extract_content_after_title(content) html_content = markdown.markdown(content_to_convert, extensions=['fenced_code', 'tables']) if 'title' in metadata: title_html = f\"{metadata['title']}\\n\" html_content = title_html + html_content images_folder = os.path.join(output_folder, 'html_images_local') os.makedirs(images_folder, exist_ok=True) html_content = update_image_paths(html_content, input_folder, images_folder) html_with_style = add_css_styles(html_content) return html_with_style def add_css_styles(html_content): style = ''' ''' return f\"{style}{html_content}\" def process_markdown_files(input_folder, output_folder): os.makedirs(output_folder, exist_ok=True) for md_file in Path(input_folder).rglob('*.md'): with open(md_file, 'r', encoding='utf-8') as file: markdown_content = file.read() html_content = markdown_to_html(markdown_content, input_folder, output_folder) output_file = Path(output_folder) / (md_file.stem + '.html') with open(output_file, 'w', encoding='utf-8') as file: file.write(html_content) print(f\"Generated HTML: {output_file}\") # Set the input folder containing markdown files input_folder_blog = './content/blog' input_folder_tech = './content/tech' input_folder_writings = './content/writings' # Set the output folder where HTML files and images will be saved output_folder = './Backup_in_HTML' # Convert all markdown files to HTML process_markdown_files(input_folder_blog, output_folder) process_markdown_files(input_folder_tech, output_folder) process_markdown_files(input_folder_writings, output_folder) （2024.08.30 苏黎世）\n",
  "wordCount" : "442",
  "inLanguage": "en",
  "datePublished": "2024-08-30T00:00:00Z",
  "dateModified": "2024-08-30T20:37:54.961809396+02:00",
  "author":{
    "@type": "Person",
    "name": "BiliBytes"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.dayday.plus/tech/2024-08-30-hugo%E5%8D%9A%E5%AE%A2%E4%B8%80%E9%94%AE%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E4%BB%A5%E5%8F%8A%E6%9C%AC%E5%9C%B0%E5%A4%87%E4%BB%BD/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "bilibytes.com",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.dayday.plus/favicon.ico"
    }
  }
}
</script>
    <link rel="icon" href="/images/avatar.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/avatar.png">

<link rel="manifest" href="/images/avatar.png">
    

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.7.0/style.css" />

    
    
    
    <link rel="stylesheet" href="/css/main.min.ec28f09e946fc0df77c187fcd0d0ebde58fca6de8efb8e1620f3d45c32d4da88.css" integrity="sha256-7CjwnpRvwN93wYf80NDr3lj8pt6O&#43;44WIPPUXDLU2og=" crossorigin="anonymous" media="screen" />
    


    
    <link rel="stylesheet" href="/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css" />

    
    <script src="/js/highlight.min.min.c607d6febd16934a82eb61d3a896ed9d869f54373cc63ce95864ed5488fe3128.js"></script>
    <script>hljs.highlightAll();</script>

    </head>
<body>
      <main class="wrapper">
<nav class="navigation">
    <section class="container">
        <a class="navigation-brand" href="/">
            &gt;&gt; bilibytes.com  
        </a>
        <input type="checkbox" id="menu-toggle" />
        <label class="menu-button float-right" for="menu-toggle">
            <span></span><span></span><span></span>
        </label>
        
        <ul class="navigation-list" id="navigation-list">
            
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="/writings/">写作</a>
            </li>
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="/blog/">博客</a>
            </li>
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="/tech/">技术</a>
            </li>
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="/archives/">归档</a>
            </li>
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="/pages/">页面</a>
            </li>
            
            

            <li class="navigation-item menu-separator">
                <span>|</span>
            </li>
    
            
    
            
        </ul>
        

  <style>
img {
    width: 72%;  
    display: block;
    margin-left: auto;
    margin-right: auto;  
    border-radius: 20px;
}



	</style>



<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
       
        
        
        
        
        
        
    </section>
</nav>
<div id="content">
<article class="blog-single">
  <header class="blog-title">
    <h1> Hugo博客一建自动部署以及本地备份</h1>
  </header>

  <p>
  <small>
    August 30, 2024&nbsp;· 442 words&nbsp;· One minute</small>

  
<p>

  <div class="blog-toc">
    <nav id="TableOfContents"></nav>
  </div>

  <section class="blog-content"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>find ./bilibytes.github.io -mindepth <span style="color:#ae81ff">1</span> ! -name <span style="color:#e6db74">&#34;.git&#34;</span> ! -name <span style="color:#e6db74">&#34;CNAME&#34;</span> ! -path <span style="color:#e6db74">&#34;./bilibytes.github.io .git/*&#34;</span> -exec rm -rf <span style="color:#f92672">{}</span> +
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>python3 backup_website_in_html.py
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>hugo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cd bilibytes.github.io
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>git init
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>git remote add origin https://github.com/bilibytes/bilibytes.github.io.git
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>git add .
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>git commit -m <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>date<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>git pull --rebase origin main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>git push --set-upstream origin main
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> markdown
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> pathlib <span style="color:#f92672">import</span> Path
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> shutil
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> yaml
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> urllib.parse <span style="color:#f92672">import</span> urlparse
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">extract_metadata_and_content</span>(markdown_content):
</span></span><span style="display:flex;"><span>    metadata <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">match</span> <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span><span style="color:#66d9ef">match</span>(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;^---\n([\s\S]+?)\n---\n([\s\S]*)&#39;</span>, markdown_content)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">match</span>:
</span></span><span style="display:flex;"><span>        metadata <span style="color:#f92672">=</span> yaml<span style="color:#f92672">.</span>safe_load(<span style="color:#66d9ef">match</span><span style="color:#f92672">.</span>group(<span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>        content <span style="color:#f92672">=</span> <span style="color:#66d9ef">match</span><span style="color:#f92672">.</span>group(<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> metadata, content
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {}, markdown_content
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">extract_content_after_title</span>(markdown_content):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">match</span> <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;(?:^|\n)#+\s+(.+?)(?:\n|$)([\s\S]*)&#39;</span>, markdown_content)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">match</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">match</span><span style="color:#f92672">.</span>group(<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> markdown_content
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">download_image</span>(image_url, images_folder, retries<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>):
</span></span><span style="display:flex;"><span>    parsed_url <span style="color:#f92672">=</span> urlparse(image_url)
</span></span><span style="display:flex;"><span>    image_name <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>basename(parsed_url<span style="color:#f92672">.</span>path)
</span></span><span style="display:flex;"><span>    local_image_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(images_folder, image_name)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> parsed_url<span style="color:#f92672">.</span>scheme <span style="color:#f92672">in</span> (<span style="color:#e6db74">&#39;http&#39;</span>, <span style="color:#e6db74">&#39;https&#39;</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> attempt <span style="color:#f92672">in</span> range(retries):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(image_url, stream<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> response<span style="color:#f92672">.</span>status_code <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">with</span> open(local_image_path, <span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> out_file:
</span></span><span style="display:flex;"><span>                        shutil<span style="color:#f92672">.</span>copyfileobj(response<span style="color:#f92672">.</span>raw, out_file)
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> requests<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>RequestException <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Attempt </span><span style="color:#e6db74">{</span>attempt <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> failed to download </span><span style="color:#e6db74">{</span>image_url<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> attempt <span style="color:#f92672">==</span> retries <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Failed to download image after </span><span style="color:#e6db74">{</span>retries<span style="color:#e6db74">}</span><span style="color:#e6db74"> attempts: </span><span style="color:#e6db74">{</span>image_url<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(image_url):
</span></span><span style="display:flex;"><span>            shutil<span style="color:#f92672">.</span>copy(image_url, local_image_path)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Local image not found: </span><span style="color:#e6db74">{</span>image_url<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(<span style="color:#e6db74">&#39;html_images_local&#39;</span>, image_name)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">update_image_paths</span>(html_content, input_folder, images_folder):
</span></span><span style="display:flex;"><span>    img_tags <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;&lt;img[^&gt;]+src=&#34;([^&#34;&gt;]+)&#34;&#39;</span>, html_content)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> img_path <span style="color:#f92672">in</span> img_tags:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> urlparse(img_path)<span style="color:#f92672">.</span>scheme:
</span></span><span style="display:flex;"><span>            img_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(input_folder, img_path)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        local_img_path <span style="color:#f92672">=</span> download_image(img_path, images_folder)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> local_img_path:
</span></span><span style="display:flex;"><span>            html_content <span style="color:#f92672">=</span> html_content<span style="color:#f92672">.</span>replace(img_path, local_img_path)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> html_content
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">markdown_to_html</span>(markdown_content, input_folder, output_folder):
</span></span><span style="display:flex;"><span>    metadata, content <span style="color:#f92672">=</span> extract_metadata_and_content(markdown_content)
</span></span><span style="display:flex;"><span>    content_to_convert <span style="color:#f92672">=</span> extract_content_after_title(content)
</span></span><span style="display:flex;"><span>    html_content <span style="color:#f92672">=</span> markdown<span style="color:#f92672">.</span>markdown(content_to_convert, extensions<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;fenced_code&#39;</span>, <span style="color:#e6db74">&#39;tables&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;title&#39;</span> <span style="color:#f92672">in</span> metadata:
</span></span><span style="display:flex;"><span>        title_html <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;&lt;h1&gt;</span><span style="color:#e6db74">{</span>metadata[<span style="color:#e6db74">&#39;title&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/h1&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        html_content <span style="color:#f92672">=</span> title_html <span style="color:#f92672">+</span> html_content
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    images_folder <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(output_folder, <span style="color:#e6db74">&#39;html_images_local&#39;</span>)
</span></span><span style="display:flex;"><span>    os<span style="color:#f92672">.</span>makedirs(images_folder, exist_ok<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    html_content <span style="color:#f92672">=</span> update_image_paths(html_content, input_folder, images_folder)
</span></span><span style="display:flex;"><span>    html_with_style <span style="color:#f92672">=</span> add_css_styles(html_content)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> html_with_style
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_css_styles</span>(html_content):
</span></span><span style="display:flex;"><span>    style <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &lt;style&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        body {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            font-family: Arial, sans-serif;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            line-height: 1.6;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            margin: 20px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            max-width: 800px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            margin-left: auto;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            margin-right: auto;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        img {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            max-width: 100%;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            height: auto;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            display: block;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            margin: 10px 0;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        pre {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            background-color: #f4f4f4;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            padding: 10px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            border-radius: 5px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            overflow-x: auto;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        code {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            font-family: monospace;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            background-color: #f4f4f4;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            padding: 2px 4px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            border-radius: 3px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        h1, h2, h3, h4, h5, h6 {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            color: #333;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        p {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            margin: 10px 0;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &lt;/style&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;&lt;html&gt;&lt;head&gt;</span><span style="color:#e6db74">{</span>style<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/head&gt;&lt;body&gt;</span><span style="color:#e6db74">{</span>html_content<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/body&gt;&lt;/html&gt;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">process_markdown_files</span>(input_folder, output_folder):
</span></span><span style="display:flex;"><span>    os<span style="color:#f92672">.</span>makedirs(output_folder, exist_ok<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> md_file <span style="color:#f92672">in</span> Path(input_folder)<span style="color:#f92672">.</span>rglob(<span style="color:#e6db74">&#39;*.md&#39;</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> open(md_file, <span style="color:#e6db74">&#39;r&#39;</span>, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf-8&#39;</span>) <span style="color:#66d9ef">as</span> file:
</span></span><span style="display:flex;"><span>            markdown_content <span style="color:#f92672">=</span> file<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        html_content <span style="color:#f92672">=</span> markdown_to_html(markdown_content, input_folder, output_folder)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        output_file <span style="color:#f92672">=</span> Path(output_folder) <span style="color:#f92672">/</span> (md_file<span style="color:#f92672">.</span>stem <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;.html&#39;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> open(output_file, <span style="color:#e6db74">&#39;w&#39;</span>, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf-8&#39;</span>) <span style="color:#66d9ef">as</span> file:
</span></span><span style="display:flex;"><span>            file<span style="color:#f92672">.</span>write(html_content)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Generated HTML: </span><span style="color:#e6db74">{</span>output_file<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Set the input folder containing markdown files</span>
</span></span><span style="display:flex;"><span>input_folder_blog <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;./content/blog&#39;</span>
</span></span><span style="display:flex;"><span>input_folder_tech <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;./content/tech&#39;</span>
</span></span><span style="display:flex;"><span>input_folder_writings <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;./content/writings&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Set the output folder where HTML files and images will be saved</span>
</span></span><span style="display:flex;"><span>output_folder <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;./Backup_in_HTML&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Convert all markdown files to HTML</span>
</span></span><span style="display:flex;"><span>process_markdown_files(input_folder_blog, output_folder)
</span></span><span style="display:flex;"><span>process_markdown_files(input_folder_tech, output_folder)
</span></span><span style="display:flex;"><span>process_markdown_files(input_folder_writings, output_folder)
</span></span></code></pre></div><p>（2024.08.30 苏黎世）</p>
</section>

  
  

  


</article>

        </div><footer class="footer">
  <p>&copy; 2025 <a href="https://www.dayday.plus/">bilibytes.com</a>
    Powered by
    <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugo️️</a>
    <a href="https://github.com/guangzhengli/hugo-theme-ladder" rel="noopener" target="_blank">Ladder</a>
️  </p>
</footer>

<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211C22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257M21.7387 7.71865C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257C17.1684 -1.24629 7.83127 0.632493 4.27577 5.04257C2.88063 6.77451 -0.0433281 11.1668 1.38159 16.6571C2.27481 20.0988 5.17269 22.2936 8.19743 22.7725M20.7188 5.04257C22.0697 6.9404 24.0299 11.3848 22.3541 15.4153M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814C11.1703 6.98257 11.0247 6.98456 10.9937 7.05061C10.5221 8.05496 9.07362 9.92941 8 10.945M11.0333 7.44444C10.9392 9.86549 11 15 12 17" stroke="currentColor" stroke-linecap="round"/>
    </svg>
</a>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>

<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'Copy';

        function copyingDone() {
            copybutton.innerHTML = 'Copied';
            setTimeout(() => {
                copybutton.innerHTML = 'Copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });
        codeblock.parentNode.appendChild(copybutton);
    });
</script></main>
    </body><script src="/main.min.cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e.js" integrity="sha512-z4PhNX7vuL3xVChQ1m2AB9Yg5AULVxXcg/SpIdNs6c5H0NE8XYXysP&#43;DGNKHfuwvY7kxvUdBeoGlODJ6&#43;SfaPg==" crossorigin="anonymous" defer></script></html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Hugo博客一建自动部署以及本地备份</title>
    
</head>
<body>
    
</body>
</html>
